"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var mainAtmMess=document.querySelector("#atmMess"),atmUserInput=document.querySelector("#atmUserInput"),leftAtmMsg1=document.querySelector("#leftAtmMsg1"),leftAtmMsg2=document.querySelector("#leftAtmMsg2"),leftAtmMsg3=document.querySelector("#leftAtmMsg3"),leftAtmMsg4=document.querySelector("#leftAtmMsg4"),rightAtmMsg1=document.querySelector("#rightAtmMsg1"),rightAtmMsg2=document.querySelector("#rightAtmMsg2"),rightAtmMsg3=document.querySelector("#rightAtmMsg3"),rightAtmMsg4=document.querySelector("#rightAtmMsg4"),leftAtmBtn1=document.querySelector("#leftAtmBtn1"),leftAtmBtn2=document.querySelector("#leftAtmBtn2"),leftAtmBtn3=document.querySelector("#leftAtmBtn3"),leftAtmBtn4=document.querySelector("#leftAtmBtn4"),rightAtmBtn1=document.querySelector("#rightAtmBtn1"),rightAtmBtn2=document.querySelector("#rightAtmBtn2"),rightAtmBtn3=document.querySelector("#rightAtmBtn3"),rightAtmBtn4=document.querySelector("#rightAtmBtn4"),mainAtmBtn0=document.querySelector("#mainAtmBtn0"),mainAtmBtn1=document.querySelector("#mainAtmBtn1"),mainAtmBtn2=document.querySelector("#mainAtmBtn2"),mainAtmBtn3=document.querySelector("#mainAtmBtn3"),mainAtmBtn4=document.querySelector("#mainAtmBtn4"),mainAtmBtn5=document.querySelector("#mainAtmBtn5"),mainAtmBtn6=document.querySelector("#mainAtmBtn6"),mainAtmBtn7=document.querySelector("#mainAtmBtn7"),mainAtmBtn8=document.querySelector("#mainAtmBtn8"),mainAtmBtn9=document.querySelector("#mainAtmBtn9"),atmBtnEnter=document.querySelector("#atmBtnEnter"),atmBtnClear=document.querySelector("#atmBtnClear"),atmBtnCancel=document.querySelector("#atmBtnCancel"),cardsInfo=document.querySelector("#cardsInfo"),atmChangeForm=document.querySelector("#atmChangeForm"),selectAtm=document.querySelector("#selectAtm"),changeAtmBtn=document.querySelector("#changeAtmBtn"),atms=[],users=[{id:12345,phoneNumber:"0667658943",cards:[{cardNumber:"1111111111111111",commission:3,credit:!0,limit:3e3,balance:-1479}]},{id:12346,phoneNumber:"0667658941",cards:[{cardNumber:"4356374609641671",commission:2,credit:!1,balance:500},{cardNumber:"4356374609641671",commission:1,credit:!0,limit:400,balance:100},{cardNumber:"4444444444444444",commission:1,balance:100}]}],atmPrevWindow=null,atmCurrentWindow=null,currentCard=null,currentAtm=null,codeLength=16,phoneLength=10,СreateATM=function(){function СreateATM(id,name,address,commission){_classCallCheck(this,СreateATM),this.id=id,this.name=name,this.address=address,this.commission=commission,atms.push(this),refreshAvailableAtm()}return _createClass(СreateATM,[{key:"_btnsCodeListener",value:function(evt){evt.preventDefault(),atmUserInput.textContent.length!==codeLength&&(atmUserInput.textContent+=evt.target.textContent)}},{key:"_clearCodeListener",value:function(evt){evt.preventDefault();var userInput=atmUserInput.textContent;0!==userInput.length&&(atmUserInput.textContent=userInput.slice(0,userInput.length-1))}},{key:"_goToOptionsListener",value:function(evt){evt.preventDefault(),this._showOptionsScreen()}},{key:"_continueErrorListener",value:function(evt){switch(evt.preventDefault(),atmPrevWindow){case"startScreen":this._showStartScreen();break;case"changePhoneScreen":this._showChangePhoneScreen();break;case"withdrawScreen":this._showWithdrawScreen()}}},{key:"_enterCodeListener",value:function(evt){evt.preventDefault();var userInput=atmUserInput.textContent;userInput.length===codeLength?this._isExistingCode(userInput)?(currentCard=userInput,this._showOptionsScreen()):this._showErrorScreen("Код не действителен!"):this._showErrorScreen("Код должен быть ".concat(codeLength," символов!"))}},{key:"_showBalanceListener",value:function(evt){evt.preventDefault(),this._showBalanceScreen()}},{key:"_endWorkListener",value:function(evt){evt.preventDefault(),this._showStartScreen()}},{key:"_changePhoneListener",value:function(evt){evt.preventDefault(),this._showChangePhoneScreen()}},{key:"_withdrawListener",value:function(evt){evt.preventDefault(),this._showWithdrawScreen()}},{key:"_withdrawCashListener",value:function(evt){var amount;switch(evt.preventDefault(),evt.target.id){case"leftAtmBtn1":amount=50;break;case"leftAtmBtn2":amount=100;break;case"leftAtmBtn3":amount=150;break;case"leftAtmBtn4":amount=200;break;case"rightAtmBtn1":amount=250;break;case"rightAtmBtn2":amount=500;break;case"rightAtmBtn4":amount=+atmUserInput.textContent}this._isValidAmount(amount)?this._isEnoughBalance(currentCard,amount)?(this.withdrawCash(currentCard,amount),this._showSuccessScreen("Деньги сняты успешно!")):this._showErrorScreen("Недостаточно средств/превышен лимит!"):this._showErrorScreen("Сумма должна быть кратная 50!")}},{key:"_enterPhoneCodeListener",value:function(evt){evt.preventDefault();var userInput=atmUserInput.textContent;userInput.length===phoneLength?(this.changePhone(currentCard,userInput),this._showSuccessScreen("Номер изменен!")):this._showErrorScreen("Код должен быть ".concat(phoneLength," символов!"))}},{key:"_showErrorScreen",value:function(message){this._hideExcess(),this._removeListeners(),atmPrevWindow=atmCurrentWindow,atmCurrentWindow="errorScreen",mainAtmMess.textContent=message,rightAtmMsg4.textContent="ОК",this._continueErrorListener=this._continueErrorListener.bind(this),atmBtnEnter.addEventListener("click",this._continueErrorListener),atmBtnCancel.addEventListener("click",this._continueErrorListener),rightAtmBtn4.addEventListener("click",this._continueErrorListener)}},{key:"_showSuccessScreen",value:function(message){this._hideExcess(),this._removeListeners(),atmCurrentWindow="successScreen",mainAtmMess.textContent=message,rightAtmMsg4.textContent="Вернуться в меню",this._goToOptionsListener=this._goToOptionsListener.bind(this),atmBtnEnter.addEventListener("click",this._goToOptionsListener),atmBtnCancel.addEventListener("click",this._goToOptionsListener),rightAtmBtn4.addEventListener("click",this._goToOptionsListener)}},{key:"_showStartScreen",value:function(){this._hideExcess(),this._removeListeners(),atmPrevWindow=null,currentCard=null,currentAtm=this,atmCurrentWindow="startScreen",mainAtmMess.innerHTML="Здравствуйте!<br> Введите номер карточки:",rightAtmMsg4.textContent="Продолжить",mainAtmBtn0.addEventListener("click",this._btnsCodeListener),mainAtmBtn1.addEventListener("click",this._btnsCodeListener),mainAtmBtn2.addEventListener("click",this._btnsCodeListener),mainAtmBtn3.addEventListener("click",this._btnsCodeListener),mainAtmBtn4.addEventListener("click",this._btnsCodeListener),mainAtmBtn5.addEventListener("click",this._btnsCodeListener),mainAtmBtn6.addEventListener("click",this._btnsCodeListener),mainAtmBtn7.addEventListener("click",this._btnsCodeListener),mainAtmBtn8.addEventListener("click",this._btnsCodeListener),mainAtmBtn9.addEventListener("click",this._btnsCodeListener),atmBtnClear.addEventListener("click",this._clearCodeListener),this._enterCodeListener=this._enterCodeListener.bind(this),rightAtmBtn4.addEventListener("click",this._enterCodeListener),atmBtnEnter.addEventListener("click",this._enterCodeListener)}},{key:"_showOptionsScreen",value:function(){this._hideExcess(),this._removeListeners(),atmCurrentWindow="optionsScreen",mainAtmMess.textContent="Выберите операцию:",leftAtmMsg3.textContent="Баланс",leftAtmMsg4.textContent="Выдача наличных",rightAtmMsg3.textContent="Сменить номер",rightAtmMsg4.textContent="Закончить работу",this._showBalanceListener=this._showBalanceListener.bind(this),leftAtmBtn3.addEventListener("click",this._showBalanceListener),this._withdrawListener=this._withdrawListener.bind(this),leftAtmBtn4.addEventListener("click",this._withdrawListener),this._changePhoneListener=this._changePhoneListener.bind(this),rightAtmBtn3.addEventListener("click",this._changePhoneListener),this._endWorkListener=this._endWorkListener.bind(this),rightAtmBtn4.addEventListener("click",this._endWorkListener)}},{key:"_showBalanceScreen",value:function(){this._hideExcess(),this._removeListeners(),atmCurrentWindow="balanceScreen";var balance=this.checkBalance(currentCard);mainAtmMess.innerHTML="На вашем балансе:<br> ".concat(balance," грн."),rightAtmMsg4.textContent="Назад",this._goToOptionsListener=this._goToOptionsListener.bind(this),rightAtmBtn4.addEventListener("click",this._goToOptionsListener),atmBtnCancel.addEventListener("click",this._goToOptionsListener)}},{key:"_showChangePhoneScreen",value:function(){this._hideExcess(),this._removeListeners(),atmCurrentWindow="changePhoneScreen",mainAtmMess.textContent="Введите новый номер телефона:",rightAtmMsg3.textContent="Назад",rightAtmMsg4.textContent="ОК",mainAtmBtn0.addEventListener("click",this._btnsCodeListener),mainAtmBtn1.addEventListener("click",this._btnsCodeListener),mainAtmBtn2.addEventListener("click",this._btnsCodeListener),mainAtmBtn3.addEventListener("click",this._btnsCodeListener),mainAtmBtn4.addEventListener("click",this._btnsCodeListener),mainAtmBtn5.addEventListener("click",this._btnsCodeListener),mainAtmBtn6.addEventListener("click",this._btnsCodeListener),mainAtmBtn7.addEventListener("click",this._btnsCodeListener),mainAtmBtn8.addEventListener("click",this._btnsCodeListener),mainAtmBtn9.addEventListener("click",this._btnsCodeListener),atmBtnClear.addEventListener("click",this._clearCodeListener),this._goToOptionsListener=this._goToOptionsListener.bind(this),rightAtmBtn3.addEventListener("click",this._goToOptionsListener),atmBtnCancel.addEventListener("click",this._goToOptionsListener),this._enterPhoneCodeListener=this._enterPhoneCodeListener.bind(this),rightAtmBtn4.addEventListener("click",this._enterPhoneCodeListener),atmBtnEnter.addEventListener("click",this._enterPhoneCodeListener)}},{key:"_showWithdrawScreen",value:function(){this._hideExcess(),this._removeListeners(),atmCurrentWindow="withdrawScreen",mainAtmMess.innerHTML="Введите сумму денег<br>кратную 50 грн. :",leftAtmMsg1.textContent="50 грн",leftAtmMsg2.textContent="100 грн",leftAtmMsg3.textContent="150 грн",leftAtmMsg4.textContent="200 грн",rightAtmMsg1.textContent="250 грн",rightAtmMsg2.textContent="500 грн",rightAtmMsg3.textContent="Назад",rightAtmMsg4.textContent="ОК",mainAtmBtn0.addEventListener("click",this._btnsCodeListener),mainAtmBtn1.addEventListener("click",this._btnsCodeListener),mainAtmBtn2.addEventListener("click",this._btnsCodeListener),mainAtmBtn3.addEventListener("click",this._btnsCodeListener),mainAtmBtn4.addEventListener("click",this._btnsCodeListener),mainAtmBtn5.addEventListener("click",this._btnsCodeListener),mainAtmBtn6.addEventListener("click",this._btnsCodeListener),mainAtmBtn7.addEventListener("click",this._btnsCodeListener),mainAtmBtn8.addEventListener("click",this._btnsCodeListener),mainAtmBtn9.addEventListener("click",this._btnsCodeListener),atmBtnClear.addEventListener("click",this._clearCodeListener),this._goToOptionsListener=this._goToOptionsListener.bind(this),rightAtmBtn3.addEventListener("click",this._goToOptionsListener),atmBtnCancel.addEventListener("click",this._goToOptionsListener),this._withdrawCashListener=this._withdrawCashListener.bind(this),rightAtmBtn4.addEventListener("click",this._withdrawCashListener),atmBtnEnter.addEventListener("click",this._withdrawCashListener),leftAtmBtn1.addEventListener("click",this._withdrawCashListener),leftAtmBtn2.addEventListener("click",this._withdrawCashListener),leftAtmBtn3.addEventListener("click",this._withdrawCashListener),leftAtmBtn4.addEventListener("click",this._withdrawCashListener),rightAtmBtn1.addEventListener("click",this._withdrawCashListener),rightAtmBtn2.addEventListener("click",this._withdrawCashListener)}},{key:"_isExistingCode",value:function(code){for(var i=0;i<users.length;i++)for(var j=0;j<users[i].cards.length;j++)if(users[i].cards[j].cardNumber==code)return!0;return!1}},{key:"_isValidAmount",value:function(amount){return 0!==amount&&amount%50==0}},{key:"_isEnoughBalance",value:function(code,amount){for(var i=0;i<users.length;i++)for(var j=0;j<users[i].cards.length;j++)if(users[i].cards[j].cardNumber==code){var totalAmount=amount+amount/100*(users[i].cards[j].commission+this.commission),balance=users[i].cards[j].balance-totalAmount;return!0===users[i].cards[j].credit?-1*users[i].cards[j].limit<=balance:balance>=0}}},{key:"_hideExcess",value:function(){mainAtmMess.textContent="",atmUserInput.textContent="",leftAtmMsg1.textContent="",leftAtmMsg2.textContent="",leftAtmMsg3.textContent="",leftAtmMsg4.textContent="",rightAtmMsg1.textContent="",rightAtmMsg2.textContent="",rightAtmMsg3.textContent="",rightAtmMsg4.textContent=""}},{key:"_removeListeners",value:function(){switch(atmCurrentWindow){case"errorScreen":atmBtnEnter.removeEventListener("click",this._continueErrorListener),atmBtnCancel.removeEventListener("click",this._continueErrorListener),rightAtmBtn4.removeEventListener("click",this._continueErrorListener);break;case"successScreen":atmBtnEnter.removeEventListener("click",this._goToOptionsListener),atmBtnCancel.removeEventListener("click",this._goToOptionsListener),rightAtmBtn4.removeEventListener("click",this._goToOptionsListener);break;case"startScreen":mainAtmBtn0.removeEventListener("click",this._btnsCodeListener),mainAtmBtn1.removeEventListener("click",this._btnsCodeListener),mainAtmBtn2.removeEventListener("click",this._btnsCodeListener),mainAtmBtn3.removeEventListener("click",this._btnsCodeListener),mainAtmBtn4.removeEventListener("click",this._btnsCodeListener),mainAtmBtn5.removeEventListener("click",this._btnsCodeListener),mainAtmBtn6.removeEventListener("click",this._btnsCodeListener),mainAtmBtn7.removeEventListener("click",this._btnsCodeListener),mainAtmBtn8.removeEventListener("click",this._btnsCodeListener),mainAtmBtn9.removeEventListener("click",this._btnsCodeListener),atmBtnClear.removeEventListener("click",this._clearCodeListener),rightAtmBtn4.removeEventListener("click",this._enterCodeListener),atmBtnEnter.removeEventListener("click",this._enterCodeListener);break;case"optionsScreen":leftAtmBtn3.removeEventListener("click",this._showBalanceListener),leftAtmBtn4.removeEventListener("click",this._withdrawListener),rightAtmBtn3.removeEventListener("click",this._changePhoneListener),rightAtmBtn4.removeEventListener("click",this._endWorkListener);break;case"balanceScreen":rightAtmBtn4.removeEventListener("click",this._goToOptionsListener),atmBtnCancel.removeEventListener("click",this._goToOptionsListener);break;case"changePhoneScreen":mainAtmBtn0.removeEventListener("click",this._btnsCodeListener),mainAtmBtn1.removeEventListener("click",this._btnsCodeListener),mainAtmBtn2.removeEventListener("click",this._btnsCodeListener),mainAtmBtn3.removeEventListener("click",this._btnsCodeListener),mainAtmBtn4.removeEventListener("click",this._btnsCodeListener),mainAtmBtn5.removeEventListener("click",this._btnsCodeListener),mainAtmBtn6.removeEventListener("click",this._btnsCodeListener),mainAtmBtn7.removeEventListener("click",this._btnsCodeListener),mainAtmBtn8.removeEventListener("click",this._btnsCodeListener),mainAtmBtn9.removeEventListener("click",this._btnsCodeListener),atmBtnClear.removeEventListener("click",this._clearCodeListener),rightAtmBtn3.removeEventListener("click",this._goToOptionsListener),atmBtnCancel.removeEventListener("click",this._goToOptionsListener),rightAtmBtn4.removeEventListener("click",this._enterPhoneCodeListener),atmBtnEnter.removeEventListener("click",this._enterPhoneCodeListener);break;case"withdrawScreen":mainAtmBtn0.removeEventListener("click",this._btnsCodeListener),mainAtmBtn1.removeEventListener("click",this._btnsCodeListener),mainAtmBtn2.removeEventListener("click",this._btnsCodeListener),mainAtmBtn3.removeEventListener("click",this._btnsCodeListener),mainAtmBtn4.removeEventListener("click",this._btnsCodeListener),mainAtmBtn5.removeEventListener("click",this._btnsCodeListener),mainAtmBtn6.removeEventListener("click",this._btnsCodeListener),mainAtmBtn7.removeEventListener("click",this._btnsCodeListener),mainAtmBtn8.removeEventListener("click",this._btnsCodeListener),mainAtmBtn9.removeEventListener("click",this._btnsCodeListener),atmBtnClear.removeEventListener("click",this._clearCodeListener),rightAtmBtn3.removeEventListener("click",this._goToOptionsListener),atmBtnCancel.removeEventListener("click",this._goToOptionsListener),rightAtmBtn4.removeEventListener("click",this._withdrawCashListener),atmBtnEnter.removeEventListener("click",this._withdrawCashListener),leftAtmBtn1.removeEventListener("click",this._withdrawCashListener),leftAtmBtn2.removeEventListener("click",this._withdrawCashListener),leftAtmBtn3.removeEventListener("click",this._withdrawCashListener),leftAtmBtn4.removeEventListener("click",this._withdrawCashListener),rightAtmBtn1.removeEventListener("click",this._withdrawCashListener),rightAtmBtn2.removeEventListener("click",this._withdrawCashListener)}}},{key:"startAtm",value:function(){this._hideExcess(),this._removeListeners(),this._showStartScreen()}},{key:"checkBalance",value:function(code){for(var i=0;i<users.length;i++)for(var j=0;j<users[i].cards.length;j++)if(users[i].cards[j].cardNumber==code)return users[i].cards[j].balance}},{key:"withdrawCash",value:function(code,amount){for(var i=0;i<users.length;i++)for(var j=0;j<users[i].cards.length;j++)if(users[i].cards[j].cardNumber==code){var totalAmount=amount+amount/100*(users[i].cards[j].commission+this.commission);users[i].cards[j].balance=users[i].cards[j].balance-totalAmount}}},{key:"changePhone",value:function(code,newNumber){for(var i=0;i<users.length;i++)for(var j=0;j<users[i].cards.length;j++)if(users[i].cards[j].cardNumber==code)return void(users[i].phoneNumber=newNumber)}},{key:"endWorkAtm",value:function(){this._hideExcess(),this._removeListeners(),atmPrevWindow=null,atmCurrentWindow=null,currentCard=null,currentAtm=null}}]),СreateATM}(),alphaBank=new СreateATM(1,"Альфа банк","Ул. Пушкина 2",3),privatBank=new СreateATM(2,"Приват банк","Ул. Пушкина 3",1),ukrBank=new СreateATM(3,"Укр банк","Ул. Пушкина 3",10),myBank=new СreateATM(4,"Мой банк","Ул. Пушкина 3",9);function refreshAvailableAtm(){var newAtm=atms[atms.length-1],opt=document.createElement("option");opt.textContent="".concat(newAtm.name,", ").concat(newAtm.address,", комиссия: ").concat(newAtm.commission,"%"),opt.value=""+newAtm.id,selectAtm.appendChild(opt)}changeAtmBtn.addEventListener("click",function(evt){evt.preventDefault();var atmId=+selectAtm.value;if(atmId){!currentAtm||currentAtm.endWorkAtm();for(var i=0;i<atms.length;i++)if(atms[i].id===atmId)return void atms[i].startAtm()}else alert("Выберите существующий банкомат!")});