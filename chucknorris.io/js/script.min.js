"use strict";let currentCategory,categories,sideNav=document.querySelector(".side-nav__list"),rdmJokeBtn=document.querySelector("#rdmJokeBtn"),jokeDesc=document.querySelector("#jokeDesc"),showMoreBtn=document.querySelector("#showMoreBtn"),hiddenCategories=[];function getCategories(){let xhr=new XMLHttpRequest;xhr.open("GET","https://api.chucknorris.io/jokes/categories",!0),xhr.send(),xhr.onreadystatechange=function(){4==this.readyState&&(200==this.status?(categories=JSON.parse(this.responseText),fillCategories()):alert("ошибка: "+(this.status?this.statusText:"запрос не удался")))}}function fillCategories(){for(let i=0;i<categories.length;i++){let sideNavItem=document.createElement("li");sideNavItem.classList.add("side-nav__item"),i>9&&(sideNavItem.classList.add("side-nav__item--hidden"),hiddenCategories.push(sideNavItem));let sideNavBtn=document.createElement("button");sideNavBtn.innerHTML=categories[i],sideNavItem.appendChild(sideNavBtn),sideNavBtn.addEventListener("click",function(evt){let xhr=new XMLHttpRequest,urlCategory="https://api.chucknorris.io/jokes/random?category="+sideNavBtn.innerHTML;xhr.open("GET",urlCategory,!0),xhr.send(),xhr.onreadystatechange=function(){if(4!=this.readyState)return;if(200!=this.status)return void alert("ошибка: "+(this.status?this.statusText:"запрос не удался"));currentCategory&&currentCategory.classList.remove("side-nav__item--current"),sideNavItem.classList.add("side-nav__item--current"),currentCategory=sideNavItem;let joke=JSON.parse(this.responseText).value;joke='"'+joke+'"',jokeDesc.innerHTML=joke}}),sideNav.appendChild(sideNavItem)}}getCategories(),rdmJokeBtn.addEventListener("click",function(evt){evt.preventDefault();let xhr=new XMLHttpRequest;if(currentCategory){let urlCategory="https://api.chucknorris.io/jokes/random?category="+currentCategory.querySelector("button").innerHTML;xhr.open("GET",urlCategory,!0)}else xhr.open("GET","https://api.chucknorris.io/jokes/random",!0);xhr.send(),xhr.onreadystatechange=function(){if(4!=this.readyState)return;if(200!=this.status)return void alert("ошибка: "+(this.status?this.statusText:"запрос не удался"));let randJoke=JSON.parse(this.responseText).value;randJoke='"'+randJoke+'"',jokeDesc.innerHTML=randJoke}}),showMoreBtn.addEventListener("click",function(evt){0!==hiddenCategories.length&&(showMoreBtn.classList.contains("side-nav__show-more--opened")?(hiddenCategories.forEach(function(elem){elem.classList.add("side-nav__item--hidden")}),showMoreBtn.classList.remove("side-nav__show-more--opened"),showMoreBtn.innerHTML="more"):(hiddenCategories.forEach(function(elem){elem.classList.remove("side-nav__item--hidden")}),showMoreBtn.classList.add("side-nav__show-more--opened"),showMoreBtn.innerHTML="close"))});