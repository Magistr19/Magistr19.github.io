"use strict";var currentGameLvl,score,intervalTimer,fruitCatchTime,catchTimeDiff,randomFruit,url="https://cut-chrysanthemum.glitch.me",currentTableDiff="hard",gamingFruits=[],gamingDiff="",maxLvl=10,isListenerFruit=!1,isTimerOn=!1,easyfruitCatchTime=[7,6,5,4,3,3,2.9,2.8,2.7,2.6],easyLvlTime=[15,20,25,30,35,40,45,50,55,60],mediumfruitCatchTime=[6,5,4,4,3.8,3.5,3,2.8,2.5,2],mediumLvlTime=[20,25,30,35,40,45,50,55,60,65],hardfruitCatchTime=[5,4,3,3,2.3,2.1,2,1.4,1.2,1],hardLvlTime=[25,30,35,40,45,50,55,60,65,70],playBtn=document.querySelector(".game__start-btn"),registerModal=document.querySelector(".modal-register"),closeModal=document.querySelector("#closeReg"),registerForm=document.querySelector(".modal-register__form"),registerSendBtn=document.querySelector(".modal-register__send-btn"),overlay=document.querySelector(".overlay"),gameField=document.querySelector(".game__field"),gameOptions=document.querySelector(".game__options"),gameOptionsStrt=document.querySelector(".game-options__start-btn"),levelBtns=document.querySelectorAll(".levels__btn"),selfScore=document.querySelector(".game__self-score"),gameCatchTimer=document.querySelector(".game__catch-timer"),gameLvlTimer=document.querySelector(".game__lvl-timer"),gamingMandarin=document.querySelector(".game__fruit--mandarin"),gamingLemon=document.querySelector(".game__fruit--lemon"),gamingWatermelon=document.querySelector(".game__fruit--watermelon"),modalWinner=document.querySelector(".game__winner-modal"),modalWinnerDesc=document.querySelector(".game-options__desc--winner"),modalWinnerScore=document.querySelector(".game-options__score--winner"),modalWinnerContinue=document.querySelector(".game-options__continue-btn"),modalWinnerEnd=document.querySelector(".game-options__end-btn--winner"),modalLooser=document.querySelector(".game__looser-modal"),modalLooserScore=document.querySelector(".game-options__score--looser"),modalLooserClose=document.querySelector(".game-options__end-btn--looser"),errorModal=document.querySelector(".modal-error"),errModalClose=document.querySelector("#closeError"),errorMessage=document.querySelector("#errorMessage");fillRecords();for(var switchTableBtns=document.querySelectorAll(".records__difficult"),i=0;i<switchTableBtns.length;i++)switchTableBtns[i].addEventListener("click",switchTableDiff);function switchTableDiff(evt){if(evt.preventDefault(),evt.target.classList.contains("records__difficult--hard")){for(var _i=0;_i<switchTableBtns.length;_i++)switchTableBtns[_i].classList.remove("records__difficult--hard"),switchTableBtns[_i].classList.add("records__difficult--easy"),switchTableBtns[_i].textContent="(Легкий)";currentTableDiff="easy"}else if(evt.target.classList.contains("records__difficult--medium")){for(var _i2=0;_i2<switchTableBtns.length;_i2++)switchTableBtns[_i2].classList.remove("records__difficult--medium"),switchTableBtns[_i2].classList.add("records__difficult--hard"),switchTableBtns[_i2].textContent="(Тяжелый)";currentTableDiff="hard"}else if(evt.target.classList.contains("records__difficult--easy")){for(var _i3=0;_i3<switchTableBtns.length;_i3++)switchTableBtns[_i3].classList.remove("records__difficult--easy"),switchTableBtns[_i3].classList.add("records__difficult--medium"),switchTableBtns[_i3].textContent="(Средний)";currentTableDiff="medium"}fillRecords()}var navBtn=document.querySelector(".page-header__nav-btn"),mainNav=document.querySelector(".main-nav");function toggleNav(evt){navBtn.classList.toggle("page-header__nav-btn--opened"),mainNav.classList.toggle("main-nav--show")}function overlayCloseModals(evt){evt.preventDefault(),registerModal.classList.remove("modal-register--show"),errorModal.classList.remove("modal-error--show"),overlay.classList.remove("overlay--show")}function closeErrModal(evt){evt.preventDefault(),errorModal.classList.remove("modal-error--show"),overlay.classList.remove("overlay--show")}if(navBtn.addEventListener("click",toggleNav),mainNav.addEventListener("click",toggleNav),overlay.addEventListener("click",overlayCloseModals),errModalClose.addEventListener("click",closeErrModal),modalWinnerContinue.addEventListener("click",function(evt){evt.preventDefault(),modalWinner.classList.remove("game-options--winner-show"),strtGame()}),modalWinnerEnd.addEventListener("click",function(evt){evt.preventDefault(),0!=confirm("Вы уверены что хотите закончить игру?")&&(modalWinner.classList.remove("game-options--winner-show"),showGameOptions())}),modalLooserClose.addEventListener("click",function(evt){evt.preventDefault(),modalLooser.classList.remove("game-options--looser-show"),showGameOptions()}),localStorage.getItem("nickName")&&localStorage.getItem("userId")&&localStorage.getItem("unlockedLvls"))showGameOptions(),openStorageLevels(),currentGameLvl=+localStorage.getItem("unlockedLvls"),setCurrentLvlBtn();else{var toggleModal=function(evt){evt.preventDefault(),overlay.classList.toggle("overlay--show"),registerModal.classList.toggle("modal-register--show")};playBtn.addEventListener("click",toggleModal),closeModal.addEventListener("click",toggleModal),registerForm.addEventListener("submit",function(evt){evt.preventDefault()}),registerSendBtn.addEventListener("click",function(evt){evt.preventDefault();var registerNick=document.querySelector("#loginNickname").value;if(registerNick.length<5||registerNick.length>12)return hideModal(),void showErrorModal("Ник от 5 до 12 символов должен быть");var postNick={};postNick.nickName=registerNick;var objStringify=JSON.stringify(postNick);fetch(url,{method:"POST",body:objStringify}).then(function(res){res.json().then(function(res){res.isSuccess?(localStorage.setItem("nickName",registerNick),localStorage.setItem("userId",""+res.data),localStorage.setItem("unlockedLvls","1"),currentGameLvl=1,hideModal(),showGameOptions(),openStorageLevels(),setCurrentLvlBtn()):(hideModal(),showErrorModal("Такой пользователь уже существует!"))})})})}function showGameOptions(){gameField.classList.add("game__field--gaming"),playBtn.classList.add("custom-btn--hide"),gameOptions.classList.add("game-options--show")}function openStorageLevels(){if(localStorage.getItem("unlockedLvls")){var unlockedLvls=+localStorage.getItem("unlockedLvls");unlockedLvls>maxLvl&&(unlockedLvls=maxLvl);for(var _i6=0;_i6<unlockedLvls;_i6++)levelBtns[_i6].disabled=!1,levelBtns[_i6].addEventListener("click",lvlBtnListener)}}function openLevel(numberLvl){numberLvl>maxLvl&&(numberLvl=maxLvl),+localStorage.getItem("unlockedLvls")<numberLvl&&localStorage.setItem("unlockedLvls",""+numberLvl),levelBtns[numberLvl-1].disabled&&(levelBtns[numberLvl-1].disabled=!1,levelBtns[numberLvl-1].addEventListener("click",lvlBtnListener))}function setCurrentLvlBtn(){for(var _i7=0;_i7<levelBtns.length;_i7++)levelBtns[_i7].classList.contains("custom-btn-2--current")&&levelBtns[_i7].classList.remove("custom-btn-2--current");levelBtns[currentGameLvl-1].classList.add("custom-btn-2--current")}function fillRecords(){var difficult=currentTableDiff,nickName=localStorage.getItem("nickName"),recordsUrl="".concat(url,"/?difficult=").concat(difficult,"&nickName=").concat(nickName);fetch(recordsUrl).then(function(res){res.json().then(function(res){if(res.isSuccess){var records=res.data,recordsTable=document.querySelector(".records__table");if(recordsTable.querySelector("tbody")){recordsTable.querySelector("tbody").remove();var tableBody=document.createElement("tbody");recordsTable.appendChild(tableBody),recordsTable=document.querySelector(".records__table tbody")}for(var _i8=0;_i8<records.length;_i8++){var tableRow=document.createElement("tr");records[_i8].nickName===localStorage.nickName&&tableRow.classList.add("records__me");var recordNumber=document.createElement("td");recordNumber.textContent=records[_i8].rank?records[_i8].rank:_i8+1;var recordNick=document.createElement("td");recordNick.textContent=records[_i8].nickName;var recordDate=document.createElement("td");recordDate.textContent=records[_i8].date;var recordScore=document.createElement("td");recordScore.textContent=records[_i8].score,tableRow.appendChild(recordNumber),tableRow.appendChild(recordNick),tableRow.appendChild(recordDate),tableRow.appendChild(recordScore),recordsTable.appendChild(tableRow)}}else console.error("Cannot load records"),console.log(res.errorText)})})}function hideModal(){overlay.classList.remove("overlay--show"),registerModal.classList.remove("modal-register--show")}function lvlBtnListener(evt){evt.preventDefault(),currentGameLvl=+evt.target.textContent,!0===isTimerOn&&(clearInterval(intervalTimer),isTimerOn=!1),selfScore.classList.remove("game__self-score--show"),gameCatchTimer.classList.remove("game__catch-timer--show"),gameLvlTimer.classList.remove("game__lvl-timer--show"),gamingMandarin.style.display="none",gamingLemon.style.display="none",gamingWatermelon.style.display="none",modalWinner.classList.remove("game-options--winner-show"),modalLooser.classList.remove("game-options--looser-show"),!0===isListenerFruit&&(gamingMandarin.removeEventListener("click",fruitListener),gamingLemon.removeEventListener("click",fruitListener),gamingWatermelon.removeEventListener("click",fruitListener),isListenerFruit=!1),showGameOptions(),setCurrentLvlBtn()}function postRecord(){var objRecord={};objRecord.score=score,objRecord.difficult=gamingDiff,objRecord.nickName=localStorage.getItem("nickName"),objRecord.userId=+localStorage.getItem("userId");var date=new Date;date=formatDate(date),objRecord.date=date;var objStringify=JSON.stringify(objRecord);fetch(url,{method:"POST",body:objStringify}).then(function(res){res.json().then(function(res){res.isSuccess&&"Result is updated"===res.data&&fillRecords()})})}function strtGame(){var lvlTime;switch(selfScore.classList.add("game__self-score--show"),gameCatchTimer.classList.add("game__catch-timer--show"),gameLvlTimer.classList.add("game__lvl-timer--show"),gamingDiff){case"easy":fruitCatchTime=easyfruitCatchTime[currentGameLvl-1],lvlTime=easyLvlTime[currentGameLvl-1];break;case"medium":fruitCatchTime=mediumfruitCatchTime[currentGameLvl-1],lvlTime=mediumLvlTime[currentGameLvl-1];break;case"hard":fruitCatchTime=hardfruitCatchTime[currentGameLvl-1],lvlTime=mediumLvlTime[currentGameLvl-1]}gamingMandarin.addEventListener("click",fruitListener),gamingLemon.addEventListener("click",fruitListener),gamingWatermelon.addEventListener("click",fruitListener),isListenerFruit=!0,selfScore.textContent="Счет: ".concat(score),console.log("Вы щас на ".concat(currentGameLvl," уровне, Уровень сложности: ").concat(gamingDiff,", Очков ").concat(score,", Время на поимку фрукта ").concat(fruitCatchTime,", Время на уровень ").concat(lvlTime)),generateRdmFruit(),catchTimeDiff=fruitCatchTime;var startTime=(new Date).getTime();function clearGameField(){clearInterval(intervalTimer),isTimerOn=!1,gamingMandarin.removeEventListener("click",fruitListener),gamingLemon.removeEventListener("click",fruitListener),gamingWatermelon.removeEventListener("click",fruitListener),isListenerFruit=!1,randomFruit.style.display="none",selfScore.classList.remove("game__self-score--show"),gameCatchTimer.classList.remove("game__catch-timer--show"),gameLvlTimer.classList.remove("game__lvl-timer--show")}isTimerOn=!0,intervalTimer=setInterval(function(){var diffTime=((new Date).getTime()-startTime)/1e3;gameLvlTimer.textContent="Продержитесь: ".concat((lvlTime-diffTime).toFixed(1)," сек"),catchTimeDiff-=.1,gameCatchTimer.textContent="Время на поимку: ".concat(catchTimeDiff.toFixed(1)," сек"),diffTime>=lvlTime&&(clearGameField(),postRecord(),showWinnerModal(),currentGameLvl<maxLvl&&(openLevel(++currentGameLvl),setCurrentLvlBtn())),catchTimeDiff<=0&&(clearGameField(),postRecord(),showLooserModal())},100)}function showWinnerModal(){modalWinner.classList.add("game-options--winner-show"),modalWinnerScore.textContent="Ваш счет: ".concat(score),currentGameLvl===maxLvl?(modalWinnerDesc.textContent="Вы прошли всю игру!",modalWinnerContinue.style.display="none"):(modalWinnerDesc.textContent="Вы прошли уровень",modalWinnerContinue.style.display="block")}function showLooserModal(){modalLooser.classList.add("game-options--looser-show"),modalLooserScore.textContent="Ваш счет: ".concat(score)}function showErrorModal(message){errorModal.classList.add("modal-error--show"),overlay.classList.add("overlay--show"),errorMessage.textContent=message}function fruitListener(evt){evt.preventDefault(),score++,selfScore.textContent="Счет: ".concat(score),evt.target.style.display="none",catchTimeDiff=fruitCatchTime,generateRdmFruit()}function generateRdmFruit(){switch(randomFruit=gamingFruits[getRandomInt(0,gamingFruits.length-1)]){case"mandarin":randomFruit=gamingMandarin;break;case"lemon":randomFruit=gamingLemon;break;case"watermelon":randomFruit=gamingWatermelon}randomFruit.style.display="block",randomFruit.style.left="calc(".concat(getRandomInt(0,gameField.offsetWidth-randomFruit.offsetWidth),"px)"),randomFruit.style.top="calc(".concat(getRandomInt(0,gameField.offsetHeight-randomFruit.offsetHeight),"px)")}function formatDate(date){var dd=date.getDate();dd<10&&(dd="0"+dd);var mm=date.getMonth()+1;mm<10&&(mm="0"+mm);var yy=date.getFullYear()%100;return yy<10&&(yy="0"+yy),dd+"."+mm+"."+yy}function getRandomInt(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min}gameOptionsStrt.addEventListener("click",function(evt){evt.preventDefault(),gamingFruits=[],gamingDiff="",score=0;for(var fruits=gameOptions.querySelectorAll(".game-options__fruits-list input"),difficulties=gameOptions.querySelectorAll(".game-options__difficult-list input"),_i4=0;_i4<fruits.length;_i4++)fruits[_i4].checked&&gamingFruits.push(fruits[_i4].getAttribute("data-fruit"));if(0!==gamingFruits.length){for(var _i5=0;_i5<difficulties.length;_i5++)if(difficulties[_i5].checked){gamingDiff=difficulties[_i5].value;break}gameOptions.classList.remove("game-options--show"),strtGame()}else showErrorModal("Укажите хотя бы один фрукт!")});